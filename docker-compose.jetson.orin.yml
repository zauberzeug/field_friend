version: "3.9"
services:
  rosys:
    network_mode: host
    restart: always
    privileged: true
    build:
      context: .

  detector:
    image: "zauberzeug/yolov5-detector:0.1.2-nlv0.10.10-35.4.1"
    restart: always
    ports:
      - "8004:80"
    hostname: ${ROBOT_ID}
    environment:
      - HOST=learning-loop.ai
      - NVIDIA_VISIBLE_DEVICES=all
      # - ORGANIZATION=zauberzeug
      # - PROJECT=coins
      - ORGANIZATION=zuckerruebe
      - PROJECT=uckerbots
    volumes:
      # - ~/data_coins:/data
      - ~/data_plants:/data

  monitoring:
    image: "zauberzeug/yolov5-detector:0.1.2-nlv0.10.10-35.4.1"
    restart: always
    ports:
      - "8005:80"
    hostname: ${ROBOT_ID}
    environment:
      - HOST=learning-loop.ai
      - ORGANIZATION=zauberzeug
      - PROJECT=monitoring
      - NVIDIA_VISIBLE_DEVICES=all
    volumes:
      - ~/data_monitoring:/data

  zedxmini:
    restart: always
    privileged: true
    runtime: nvidia
    build:
      context: ../zedxmini
      dockerfile: ../zedxmini/Dockerfile
      # dockerfile: ../zedxmini/Dockerfile.JP6
    volumes:
      - ../zedxmini:/app
      - /dev:/dev
      - /tmp:/tmp
      - /var/nvidia/nvcam/settings/:/var/nvidia/nvcam/settings
      - /etc/systemd/system/zed_x_daemon.service:/etc/systemd/system/zed_x_daemon.service
      - /usr/local/zed/resources:/usr/local/zed/resources
    ports:
      - "8003:8003"
    environment:
      - TZ=Europe/Amsterdam

  autoheal:
    restart: always
